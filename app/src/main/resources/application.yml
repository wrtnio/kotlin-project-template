# Spring 기본 설정
spring:
    application:
        name: Wrtn Project Template

    profiles:
        active: "dev"
        default: "dev"

    info:
        build:
            encoding: UTF-8
    codec:
        max-in-memory-size: 100MB
    jackson:
        serialization:
            indent-output: true

    lifecycle:
        timeout-per-shutdown-phase: 10s     # Gradeful Shutdown 시간

    data:
        mongodb:
            host: ${testcontainers.mongo.host}
            port: ${testcontainers.mongo.port}
            database: test
            auto-index-creation: true

    main:
        allow-bean-definition-overriding: true      # Bean 재정의 허용

info:
    name: ${spring.application.name}
    description: Wrtn Project Template
    environment: ${spring.profiles.active}
    version: 0.0.1

# Server
server:
    compression:
        enabled: true
        min-response-size: 10KB

    shutdown: graceful  # WebServer Graceful shutdown (https://www.baeldung.com/spring-boot-web-server-shutdown)

app:
    redirect:
        root: /swagger-ui.html

# Management (Actuator)
management:
    endpoints:
        web.exposure.include: '*'

    endpoint:
        health:
            show-components: always
            show-details: always
        metrics:
            enabled: true
        prometheus:
            enabled: true

    metrics:
        tags:
            application: ${spring.application.name}
            profile: ${spring.profiles.active}

        distribution:
            percentiles-histogram:
                http.server.requests: true                  # HTTP 요청에 대한 히스토그램을 수집
                resilience4j.circuitbreaker.calls: true     # CircuitBreaker 호출에 대한 히스토그램을 수집

    health:
        diskspace:
            enabled: false
        circuitbreakers:
            enabled: true
        ratelimiters:
            enabled: true

# swagger-ui custom path
springdoc:
    swagger-ui:
        path: /swagger-ui.html


resilience4j:
    circuitbreaker:
        configs:
            default:
                registerHealthIndicator: true
                slidingWindowSize: 10
                permittedNumberOfCallsInHalfOpenState: 3
                automaticTransitionFromOpenToHalfOpenEnabled: true
                waitDurationInOpenState: 5s
                failureRateThreshold: 50
                eventConsumerBufferSize: 10

        instances:
            alimtalk:
                minimumNumberOfCalls: 10
                waitDurationInOpenState: 3s
                failureRateThreshold: 10

    retry:
        configs:
            default:
                max-attempts: 3
                waitDuration: 10
        instances:
            alimtalk:
                baseConfig: default

    ratelimiter:
        configs:
            default:
                registerHealthIndicator: true
                limitForPeriod: 50
                limitRefreshPeriod: 100ms
                timeoutDuration: 5s
                eventConsumerBufferSize: 100

        instances:
            alimtalk:
                baseConfig: default

    timelimiter:
        configs:
            default:
                cancelRunningFuture: false
                timeoutDuration: 5s

        instances:
            alimtalk:
                cancelRunningFuture: true
                timeoutDuration: 10s
